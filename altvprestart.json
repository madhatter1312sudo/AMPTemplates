[
  {
    "PreStartStageName": "TEST: Verify PreStartStages Run",
    "PreStartSourcePlatform": "Linux",
    "PreStartSource": "RunScript",
    "PreStartSourceData": "echo '========================================' && echo 'PRESTART STAGE 1: VERIFICATION TEST' && echo '========================================' && pwd && echo 'Current directory listing:' && ls -la && echo '' && echo 'Creating test file to verify PreStartStages run...' && echo 'PRESTART_STAGES_ARE_RUNNING' > PRESTART_TEST.txt && ls -lh PRESTART_TEST.txt && echo 'SUCCESS: PreStartStages are running!' && echo '========================================'",
    "RunInShell": true
  },
  {
    "PreStartStageName": "CRITICAL: Ensure altv-server Exists",
    "PreStartSourcePlatform": "Linux",
    "PreStartSource": "RunScript",
    "PreStartSourceData": "echo '========================================' && echo 'PRESTART STAGE 2: DOWNLOAD ALTV-SERVER' && echo '========================================' && pwd && echo '' && echo 'Step 1: Creating directories...' && mkdir -p GenericApplication && cd GenericApplication && pwd && echo '' && echo 'Step 2: Checking if altv-server exists...' && if [ -f altv-server ]; then echo 'altv-server already exists!' && ls -lh altv-server; else echo 'altv-server NOT FOUND - downloading now...' && echo '' && if command -v wget >/dev/null 2>&1; then echo 'Using wget to download...' && wget --no-check-certificate --progress=bar:force -O altv-server https://cdn.alt-mp.com/server/release/x64_linux/altv-server 2>&1 && echo '' && if [ -f altv-server ] && [ -s altv-server ]; then chmod +x altv-server && echo 'Download SUCCESSFUL!' && ls -lh altv-server && echo 'File size check:' && wc -c altv-server; else echo 'ERROR: Download failed - file missing or empty!'; fi; elif command -v curl >/dev/null 2>&1; then echo 'Using curl to download...' && curl -k -L --progress-bar -o altv-server https://cdn.alt-mp.com/server/release/x64_linux/altv-server 2>&1 && echo '' && if [ -f altv-server ] && [ -s altv-server ]; then chmod +x altv-server && echo 'Download SUCCESSFUL!' && ls -lh altv-server && echo 'File size check:' && wc -c altv-server; else echo 'ERROR: Download failed - file missing or empty!'; fi; else echo 'ERROR: Neither wget nor curl available!'; exit 1; fi; fi && echo '' && echo 'Step 3: Final verification...' && if [ -f altv-server ]; then echo 'SUCCESS: altv-server EXISTS at:' && pwd && ls -lh altv-server && echo 'Permissions:' && ls -l altv-server; else echo 'ERROR: altv-server STILL MISSING after download attempt!'; echo 'Current directory:' && pwd && echo 'Directory contents:' && ls -la; exit 1; fi && echo '========================================'",
    "RunInShell": true
  },
  {
    "PreStartStageName": "Download Data Files",
    "PreStartSourcePlatform": "Linux",
    "PreStartSource": "RunScript",
    "PreStartSourceData": "echo '========================================' && echo 'PRESTART STAGE 3: DOWNLOAD DATA FILES' && echo '========================================' && mkdir -p GenericApplication/data && cd GenericApplication/data && pwd && if command -v wget >/dev/null 2>&1; then DOWNLOAD_CMD='wget'; elif command -v curl >/dev/null 2>&1; then DOWNLOAD_CMD='curl'; else echo 'ERROR: Neither wget nor curl available!'; fi && for file in vehmodels.bin vehmods.bin pedmodels.bin weaponmodels.bin; do if [ ! -f \"$file\" ] || [ ! -s \"$file\" ]; then echo \"Downloading $file...\" && if [ \"$DOWNLOAD_CMD\" = 'wget' ]; then wget --no-check-certificate -O \"$file\" \"https://cdn.alt-mp.com/server/release/x64_linux/data/$file\" 2>&1 && if [ -f \"$file\" ]; then echo \"$file downloaded successfully\" && ls -lh \"$file\"; else echo \"ERROR: Failed to download $file\"; fi; else curl -k -L -o \"$file\" \"https://cdn.alt-mp.com/server/release/x64_linux/data/$file\" 2>&1 && if [ -f \"$file\" ]; then echo \"$file downloaded successfully\" && ls -lh \"$file\"; else echo \"ERROR: Failed to download $file\"; fi; fi; else echo \"$file already exists\" && ls -lh \"$file\"; fi; done && echo '========================================'",
    "RunInShell": true
  },
  {
    "PreStartStageName": "Download Modules",
    "PreStartSourcePlatform": "Linux",
    "PreStartSource": "RunScript",
    "PreStartSourceData": "echo '========================================' && echo 'PRESTART STAGE 4: DOWNLOAD MODULES' && echo '========================================' && mkdir -p GenericApplication/modules/js-module GenericApplication/modules && cd GenericApplication && pwd && if command -v wget >/dev/null 2>&1; then DOWNLOAD_CMD='wget'; elif command -v curl >/dev/null 2>&1; then DOWNLOAD_CMD='curl'; else echo 'ERROR: Neither wget nor curl available!'; fi && if [ ! -f modules/js-module/libjs-module.so ] || [ ! -s modules/js-module/libjs-module.so ]; then echo 'Downloading libjs-module.so...' && if [ \"$DOWNLOAD_CMD\" = 'wget' ]; then wget --no-check-certificate -O modules/js-module/libjs-module.so https://cdn.alt-mp.com/js-module/release/x64_linux/libjs-module.so 2>&1 && if [ -f modules/js-module/libjs-module.so ]; then chmod +x modules/js-module/libjs-module.so && echo 'libjs-module.so downloaded' && ls -lh modules/js-module/libjs-module.so; else echo 'ERROR: Failed to download libjs-module.so'; fi; else curl -k -L -o modules/js-module/libjs-module.so https://cdn.alt-mp.com/js-module/release/x64_linux/libjs-module.so 2>&1 && if [ -f modules/js-module/libjs-module.so ]; then chmod +x modules/js-module/libjs-module.so && echo 'libjs-module.so downloaded' && ls -lh modules/js-module/libjs-module.so; else echo 'ERROR: Failed to download libjs-module.so'; fi; fi; fi && if [ ! -f modules/js-module/libnode.so.108 ] || [ ! -s modules/js-module/libnode.so.108 ]; then echo 'Downloading libnode.so.108...' && if [ \"$DOWNLOAD_CMD\" = 'wget' ]; then wget --no-check-certificate -O modules/js-module/libnode.so.108 https://cdn.alt-mp.com/js-module/release/x64_linux/libnode.so.108 2>&1 && if [ -f modules/js-module/libnode.so.108 ]; then chmod +x modules/js-module/libnode.so.108 && echo 'libnode.so.108 downloaded' && ls -lh modules/js-module/libnode.so.108; else echo 'ERROR: Failed to download libnode.so.108'; fi; else curl -k -L -o modules/js-module/libnode.so.108 https://cdn.alt-mp.com/js-module/release/x64_linux/libnode.so.108 2>&1 && if [ -f modules/js-module/libnode.so.108 ]; then chmod +x modules/js-module/libnode.so.108 && echo 'libnode.so.108 downloaded' && ls -lh modules/js-module/libnode.so.108; else echo 'ERROR: Failed to download libnode.so.108'; fi; fi; fi && if [ ! -f modules/libcsharp-module.so ] || [ ! -s modules/libcsharp-module.so ]; then echo 'Downloading libcsharp-module.so...' && if [ \"$DOWNLOAD_CMD\" = 'wget' ]; then wget --no-check-certificate -O modules/libcsharp-module.so https://cdn.alt-mp.com/coreclr-module/release/x64_linux/libcsharp-module.so 2>&1 && if [ -f modules/libcsharp-module.so ]; then chmod +x modules/libcsharp-module.so && echo 'libcsharp-module.so downloaded' && ls -lh modules/libcsharp-module.so; else echo 'ERROR: Failed to download libcsharp-module.so'; fi; else curl -k -L -o modules/libcsharp-module.so https://cdn.alt-mp.com/coreclr-module/release/x64_linux/libcsharp-module.so 2>&1 && if [ -f modules/libcsharp-module.so ]; then chmod +x modules/libcsharp-module.so && echo 'libcsharp-module.so downloaded' && ls -lh modules/libcsharp-module.so; else echo 'ERROR: Failed to download libcsharp-module.so'; fi; fi; fi && if [ ! -f AltV.Net.Host.dll ] || [ ! -s AltV.Net.Host.dll ]; then echo 'Downloading AltV.Net.Host.dll...' && if [ \"$DOWNLOAD_CMD\" = 'wget' ]; then wget --no-check-certificate -O AltV.Net.Host.dll https://cdn.alt-mp.com/coreclr-module/release/x64_linux/AltV.Net.Host.dll 2>&1 && if [ -f AltV.Net.Host.dll ]; then echo 'AltV.Net.Host.dll downloaded' && ls -lh AltV.Net.Host.dll; else echo 'ERROR: Failed to download AltV.Net.Host.dll'; fi; else curl -k -L -o AltV.Net.Host.dll https://cdn.alt-mp.com/coreclr-module/release/x64_linux/AltV.Net.Host.dll 2>&1 && if [ -f AltV.Net.Host.dll ]; then echo 'AltV.Net.Host.dll downloaded' && ls -lh AltV.Net.Host.dll; else echo 'ERROR: Failed to download AltV.Net.Host.dll'; fi; fi; fi && if [ ! -f AltV.Net.Host.runtimeconfig.json ] || [ ! -s AltV.Net.Host.runtimeconfig.json ]; then echo 'Downloading AltV.Net.Host.runtimeconfig.json...' && if [ \"$DOWNLOAD_CMD\" = 'wget' ]; then wget --no-check-certificate -O AltV.Net.Host.runtimeconfig.json https://cdn.alt-mp.com/coreclr-module/release/x64_linux/AltV.Net.Host.runtimeconfig.json 2>&1 && if [ -f AltV.Net.Host.runtimeconfig.json ]; then echo 'AltV.Net.Host.runtimeconfig.json downloaded' && ls -lh AltV.Net.Host.runtimeconfig.json; else echo 'ERROR: Failed to download AltV.Net.Host.runtimeconfig.json'; fi; else curl -k -L -o AltV.Net.Host.runtimeconfig.json https://cdn.alt-mp.com/coreclr-module/release/x64_linux/AltV.Net.Host.runtimeconfig.json 2>&1 && if [ -f AltV.Net.Host.runtimeconfig.json ]; then echo 'AltV.Net.Host.runtimeconfig.json downloaded' && ls -lh AltV.Net.Host.runtimeconfig.json; else echo 'ERROR: Failed to download AltV.Net.Host.runtimeconfig.json'; fi; fi; fi && echo 'Setting final permissions...' && chmod +x altv-server 2>/dev/null || true && find modules -name '*.so' -exec chmod +x {} \\; 2>/dev/null || true && chmod -R 755 modules 2>/dev/null || true && chmod -R 755 . 2>/dev/null || true && echo '========================================'",
    "RunInShell": true
  },
  {
    "PreStartStageName": "Create server.cfg",
    "PreStartSourcePlatform": "Linux",
    "PreStartSource": "RunScript",
    "PreStartSourceData": "echo '========================================' && echo 'PRESTART STAGE 5: CREATE SERVER.CFG' && echo '========================================' && cat > GenericApplication/server.cfg << 'CFGEOF'\nname: Regenesis\nhost: 0.0.0.0\nport: 7788\nhttpPort: 7780\nplayers: 128\npassword: \ntoken: \nannounce: false\ngamemode: Freeroam\nwebsite: \nlanguage: en\ndescription: Alt:V Multiplayer Server\nmodules: [ ]\nresources: [ ]\nCFGEOF\n && echo 'server.cfg created' && ls -lh GenericApplication/server.cfg && echo '========================================'",
    "RunInShell": true
  }
]
