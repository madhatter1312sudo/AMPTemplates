[
  {
    "PreStartStageName": "Ensure Directories Exist with Correct Permissions and Download Alt:V Server",
    "PreStartSourcePlatform": "Linux",
    "PreStartSource": "RunScript",
    "PreStartSourceData": "set -e && echo '=== PreStart: Creating directories with correct permissions ===' && mkdir -p GenericApplication/data GenericApplication/modules/js-module GenericApplication/modules && chmod -R 755 GenericApplication && echo 'Directories created with permissions' && cd GenericApplication && pwd && echo '=== PreStart: Downloading altv-server ===' && if command -v wget >/dev/null 2>&1; then if [ ! -f altv-server ] || [ ! -s altv-server ]; then echo 'Downloading altv-server with wget...' && wget -O altv-server https://cdn.alt-mp.com/server/release/x64_linux/altv-server && chmod +x altv-server && ls -lh altv-server && echo 'altv-server downloaded successfully'; else echo 'altv-server already exists'; ls -lh altv-server; fi; elif command -v curl >/dev/null 2>&1; then if [ ! -f altv-server ] || [ ! -s altv-server ]; then echo 'Downloading altv-server with curl...' && curl -L -o altv-server https://cdn.alt-mp.com/server/release/x64_linux/altv-server && chmod +x altv-server && ls -lh altv-server && echo 'altv-server downloaded successfully'; else echo 'altv-server already exists'; ls -lh altv-server; fi; else echo 'ERROR: Neither wget nor curl available!' && exit 1; fi && echo 'Setting final permissions on all files...' && chmod -R 755 GenericApplication 2>/dev/null || true",
    "RunInShell": true
  },
  {
    "PreStartStageName": "Download Data Files",
    "PreStartSourcePlatform": "Linux",
    "PreStartSource": "RunScript",
    "PreStartSourceData": "set -e && echo '=== PreStart: Downloading data files ===' && mkdir -p GenericApplication/data && cd GenericApplication/data && if command -v wget >/dev/null 2>&1; then DOWNLOAD_CMD='wget'; elif command -v curl >/dev/null 2>&1; then DOWNLOAD_CMD='curl -L -o'; else echo 'ERROR: Neither wget nor curl available!' && exit 1; fi && for file in vehmodels.bin vehmods.bin pedmodels.bin weaponmodels.bin; do if [ ! -f \"$file\" ] || [ ! -s \"$file\" ]; then echo \"Downloading $file...\" && if [ \"$DOWNLOAD_CMD\" = 'wget' ]; then wget -O \"$file\" \"https://cdn.alt-mp.com/server/release/x64_linux/data/$file\" && echo \"$file downloaded\" && ls -lh \"$file\"; else curl -L -o \"$file\" \"https://cdn.alt-mp.com/server/release/x64_linux/data/$file\" && echo \"$file downloaded\" && ls -lh \"$file\"; fi; else echo \"$file already exists\"; ls -lh \"$file\"; fi; done",
    "RunInShell": true
  },
  {
    "PreStartStageName": "Download Modules and Fix Permissions",
    "PreStartSourcePlatform": "Linux",
    "PreStartSource": "RunScript",
    "PreStartSourceData": "set -e && echo '=== PreStart: Downloading modules ===' && mkdir -p GenericApplication/modules/js-module GenericApplication/modules && cd GenericApplication && if command -v wget >/dev/null 2>&1; then DOWNLOAD_CMD='wget'; elif command -v curl >/dev/null 2>&1; then DOWNLOAD_CMD='curl -L -o'; else echo 'ERROR: Neither wget nor curl available!' && exit 1; fi && if [ ! -f modules/js-module/libjs-module.so ] || [ ! -s modules/js-module/libjs-module.so ]; then echo 'Downloading libjs-module.so...' && if [ \"$DOWNLOAD_CMD\" = 'wget' ]; then wget -O modules/js-module/libjs-module.so https://cdn.alt-mp.com/js-module/release/x64_linux/libjs-module.so && chmod +x modules/js-module/libjs-module.so && ls -lh modules/js-module/libjs-module.so; else curl -L -o modules/js-module/libjs-module.so https://cdn.alt-mp.com/js-module/release/x64_linux/libjs-module.so && chmod +x modules/js-module/libjs-module.so && ls -lh modules/js-module/libjs-module.so; fi; fi && if [ ! -f modules/js-module/libnode.so.108 ] || [ ! -s modules/js-module/libnode.so.108 ]; then echo 'Downloading libnode.so.108...' && if [ \"$DOWNLOAD_CMD\" = 'wget' ]; then wget -O modules/js-module/libnode.so.108 https://cdn.alt-mp.com/js-module/release/x64_linux/libnode.so.108 && chmod +x modules/js-module/libnode.so.108 && ls -lh modules/js-module/libnode.so.108; else curl -L -o modules/js-module/libnode.so.108 https://cdn.alt-mp.com/js-module/release/x64_linux/libnode.so.108 && chmod +x modules/js-module/libnode.so.108 && ls -lh modules/js-module/libnode.so.108; fi; fi && if [ ! -f modules/libcsharp-module.so ] || [ ! -s modules/libcsharp-module.so ]; then echo 'Downloading libcsharp-module.so...' && if [ \"$DOWNLOAD_CMD\" = 'wget' ]; then wget -O modules/libcsharp-module.so https://cdn.alt-mp.com/coreclr-module/release/x64_linux/libcsharp-module.so && chmod +x modules/libcsharp-module.so && ls -lh modules/libcsharp-module.so; else curl -L -o modules/libcsharp-module.so https://cdn.alt-mp.com/coreclr-module/release/x64_linux/libcsharp-module.so && chmod +x modules/libcsharp-module.so && ls -lh modules/libcsharp-module.so; fi; fi && if [ ! -f AltV.Net.Host.dll ] || [ ! -s AltV.Net.Host.dll ]; then echo 'Downloading AltV.Net.Host.dll...' && if [ \"$DOWNLOAD_CMD\" = 'wget' ]; then wget -O AltV.Net.Host.dll https://cdn.alt-mp.com/coreclr-module/release/x64_linux/AltV.Net.Host.dll && ls -lh AltV.Net.Host.dll; else curl -L -o AltV.Net.Host.dll https://cdn.alt-mp.com/coreclr-module/release/x64_linux/AltV.Net.Host.dll && ls -lh AltV.Net.Host.dll; fi; fi && if [ ! -f AltV.Net.Host.runtimeconfig.json ] || [ ! -s AltV.Net.Host.runtimeconfig.json ]; then echo 'Downloading AltV.Net.Host.runtimeconfig.json...' && if [ \"$DOWNLOAD_CMD\" = 'wget' ]; then wget -O AltV.Net.Host.runtimeconfig.json https://cdn.alt-mp.com/coreclr-module/release/x64_linux/AltV.Net.Host.runtimeconfig.json && ls -lh AltV.Net.Host.runtimeconfig.json; else curl -L -o AltV.Net.Host.runtimeconfig.json https://cdn.alt-mp.com/coreclr-module/release/x64_linux/AltV.Net.Host.runtimeconfig.json && ls -lh AltV.Net.Host.runtimeconfig.json; fi; fi && echo 'Setting final permissions on all files and directories...' && chmod +x altv-server 2>/dev/null && find modules -name '*.so' -exec chmod +x {} \\; 2>/dev/null || true && chmod -R 755 modules 2>/dev/null || true && chmod -R 755 . 2>/dev/null || true && echo '=== PreStart complete! ===' && echo 'Verifying altv-server exists:' && ls -lh altv-server && echo 'File exists and is executable!'",
    "RunInShell": true
  },
  {
    "PreStartStageName": "Create server.cfg",
    "PreStartSourcePlatform": "Linux",
    "PreStartSource": "RunScript",
    "PreStartSourceData": "echo '=== PreStart: Creating server.cfg ===' && cat > GenericApplication/server.cfg << 'CFGEOF'\nname: Regenesis\nhost: 0.0.0.0\nport: 7788\nhttpPort: 7780\nplayers: 128\npassword: \ntoken: \nannounce: false\ngamemode: Freeroam\nwebsite: \nlanguage: en\ndescription: Alt:V Multiplayer Server\nmodules: [ ]\nresources: [ ]\nCFGEOF\n && echo 'server.cfg created' && ls -lh GenericApplication/server.cfg",
    "RunInShell": true
  }
]
